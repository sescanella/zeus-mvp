# Plan: Execute Metadata Schema Migration

---
wave: 1
depends_on: []
files_modified:
- Metadata Google Sheet (column 11 added)
- backend/repositories/column_map_cache.py (cache invalidated)
autonomous: true
---

## Context

The verification report shows that `backend/scripts/extend_metadata_schema.py` exists and works, but hasn't been executed. The Metadata sheet currently has 10 columns but needs 11 columns to support granular union-level audit logging in v4.0.

Missing column:
- N_UNION (position 11): Nullable integer field to identify specific union in granular events

The migration script is idempotent and uses the append-column strategy for backward compatibility.

## Task

<task>
Execute the Metadata schema migration to add the N_UNION column at position 11.
</task>

<subtasks>

1. **Verify current sheet state**
   - Check that Metadata sheet currently has 10 columns
   - Confirm column 11 (N_UNION) doesn't already exist

2. **Execute migration script**
   - Run `backend/scripts/extend_metadata_schema.py`
   - Script will add N_UNION header at position 11
   - Script will invalidate ColumnMapCache after success

3. **Verify migration success**
   - Confirm Metadata sheet now has 11 columns
   - Verify column 11 header is "N_UNION"
   - Check that existing rows don't have values in column 11 (nullable field)

4. **Test MetadataRepository compatibility**
   - Verify existing log_event() still works (backward compatible)
   - Test that n_union parameter is optional

</subtasks>

## Verification

<verification>

After execution, verify:

1. **Sheet structure**:
   - Metadata sheet has exactly 11 columns
   - Column 11 header = "N_UNION"
   - Columns 1-10 unchanged (backward compatibility)

2. **Existing data**:
   - All existing rows have empty/null value in column 11
   - No data corruption in columns 1-10

3. **Repository behavior**:
   - MetadataRepository.log_event() works without n_union parameter
   - MetadataRepository.log_event() accepts n_union parameter
   - ColumnMapCache maps "N_UNION" to index 11

</verification>

## must_haves

<must_haves>

After this plan:

1. Metadata sheet MUST have 11 columns total
2. Column 11 MUST be named "N_UNION"
3. Existing Metadata entries MUST remain intact (backward compatibility)
4. MetadataRepository MUST support both v3.0 (no N_UNION) and v4.0 (with N_UNION) logging

</must_haves>