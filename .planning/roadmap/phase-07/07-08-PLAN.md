# Plan: Validate All Schemas and Handle Uniones Gap

---
wave: 2
depends_on: [07-06, 07-07]
files_modified:
- backend/scripts/validate_uniones_sheet.py (enhanced with --fix option)
- main.py (startup validation adjusted)
autonomous: true
---

## Context

After executing the Operaciones and Metadata migrations, we need to:
1. Validate that those migrations succeeded
2. Address the Uniones sheet gap (9 missing columns)
3. Ensure the FastAPI startup validation handles the incomplete Uniones gracefully

The Uniones sheet is populated by Engineering as an external process. We can add the column headers, but Engineering must populate the data. Until then, the system should fail-fast with clear error messages.

## Task

<task>
Validate all schema migrations and provide a path forward for the Uniones sheet gap.
</task>

<subtasks>

1. **Run comprehensive schema validation**
   - Execute `backend/scripts/validate_schema_startup.py`
   - Should report Operaciones and Metadata as valid
   - Should report Uniones as invalid with specific missing columns

2. **Enhance Uniones validation with fix option**
   - Add `--fix` flag to `validate_uniones_sheet.py`
   - When --fix is used, add missing column headers to Uniones sheet
   - This prepares the sheet structure for Engineering to populate

3. **Document the Uniones dependency**
   - Create clear documentation about what Engineering needs to provide
   - List all 18 required columns with their data types
   - Provide example data format

4. **Test FastAPI startup behavior**
   - Start the server and verify it fails fast if Uniones is incomplete
   - Ensure error message is clear about what's missing
   - Confirm server starts successfully once all schemas are valid

</subtasks>

## Verification

<verification>

After execution, verify:

1. **Operaciones validation**:
   - validate_schema_startup.py reports Operaciones as valid
   - Shows 72 columns found, all required columns present

2. **Metadata validation**:
   - validate_schema_startup.py reports Metadata as valid
   - Shows 11 columns found, N_UNION at position 11

3. **Uniones validation**:
   - validate_schema_startup.py reports Uniones as invalid
   - Lists exactly which columns are missing
   - --fix option adds headers (but sheet remains functionally incomplete until data populated)

4. **FastAPI startup**:
   - Server fails to start with clear error about Uniones
   - Error message lists missing columns
   - Once Uniones fixed, server starts successfully

</verification>

## must_haves

<must_haves>

After this plan:

1. Operaciones and Metadata schemas MUST be validated as complete
2. Uniones validation MUST clearly identify all missing columns
3. FastAPI MUST fail-fast with actionable error if schemas incomplete
4. Documentation MUST exist for Engineering to complete Uniones population

</must_haves>