---
phase: 07-data-model-foundation
plan: 07
type: execute
wave: 2
depends_on: ["07-06"]
files_modified:
  - "backend/scripts/validate_uniones_sheet.py"
  - "docs/engineering-handoff.md"
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Engineering team has clear documentation of required Uniones columns"
    - "Validation script can add missing column headers if needed"
    - "System prepared for Engineering data population"
  artifacts:
    - path: "docs/engineering-handoff.md"
      provides: "Engineering requirements for Uniones completion"
      min_lines: 50
    - path: "backend/scripts/validate_uniones_sheet.py"
      provides: "Script with --fix flag to add headers"
      pattern: "--fix.*add_missing_headers"
  key_links:
    - from: "engineering-handoff.md"
      to: "Uniones sheet requirements"
      via: "Column specifications and data types"
    - from: "validate_uniones_sheet.py --fix"
      to: "Uniones sheet"
      via: "batch_update to add headers"
---

<objective>
Document Uniones requirements for Engineering team and prepare sheet structure

Purpose: Close gap from verification - Uniones sheet missing 9 columns that Engineering must populate
Output: Clear documentation and option to add column headers for Engineering
</objective>

<execution_context>
@/Users/sescanella/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sescanella/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-model-foundation/07-VERIFICATION.md

# Uniones validation from prior plan
@.planning/phases/07-data-model-foundation/07-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create engineering handoff documentation</name>
  <files>docs/engineering-handoff.md</files>
  <action>
    Create comprehensive documentation for Engineering team explaining:

    1. Current state: Uniones sheet has 13 columns but needs 18
    2. Missing columns (9 total):
       - ID (unique identifier for union record)
       - TAG_SPOOL (foreign key to Operaciones)
       - NDT_FECHA (non-destructive testing date)
       - NDT_STATUS (testing result)
       - version (UUID4 for optimistic locking)
       - Creado_Por (audit: created by)
       - Fecha_Creacion (audit: creation date)
       - Modificado_Por (audit: modified by)
       - Fecha_Modificacion (audit: modification date)

    3. Data format specifications:
       - ID: Sequential integer
       - TAG_SPOOL: Must match Operaciones.TAG_SPOOL
       - Dates: DD-MM-YYYY format
       - Worker format: INICIALES(ID) e.g., "MR(93)"
       - version: UUID4 string

    4. Population requirements:
       - Each TAG_SPOOL can have multiple unions (1-to-many)
       - N_UNION should be unique within each TAG_SPOOL
       - DN_UNION is diameter in inches (float with 1 decimal)
       - TIPO_UNION from allowed values

    Include SQL-like schema definition and example data rows.
  </action>
  <verify>cat docs/engineering-handoff.md | grep -c "Missing columns"</verify>
  <done>Documentation created with clear column specifications and data examples</done>
</task>

<task type="auto">
  <name>Task 2: Enhance validation script with fix capability</name>
  <files>backend/scripts/validate_uniones_sheet.py</files>
  <action>
    Update the validation script to add --fix flag that can:

    1. Add missing column headers (structure only, not data)
    2. Position columns in correct order (1-18)
    3. Preserve any existing data in current 13 columns
    4. Use batch_update for efficient header addition

    The script should:
    - Default to validation-only mode (safe)
    - With --fix flag, add headers but warn about empty data
    - Log exactly what columns were added
    - Still require Engineering to populate the data

    This gives Engineering the option to have us set up the structure
    while they focus on populating the data.
  </action>
  <verify>python backend/scripts/validate_uniones_sheet.py --help | grep fix</verify>
  <done>Script has --fix flag to add missing headers (structure only)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    - Engineering handoff documentation at docs/engineering-handoff.md
    - Enhanced validation script with --fix capability
    - Clear specification of 9 missing columns
  </what-built>
  <how-to-verify>
    1. Review docs/engineering-handoff.md for clarity
    2. Run: python backend/scripts/validate_uniones_sheet.py
       (Should report 9 missing columns)
    3. Optionally test: python backend/scripts/validate_uniones_sheet.py --fix --dry-run
       (Would add headers without modifying sheet)

    Next steps for human:
    - Share engineering-handoff.md with Engineering team
    - Coordinate timeline for Uniones data population
    - Decide whether to run --fix to add headers now or let Engineering handle it
  </how-to-verify>
  <resume-signal>Type "approved" after reviewing documentation and coordinating with Engineering</resume-signal>
</task>

</tasks>

<verification>
1. Engineering documentation clearly specifies all 9 missing columns
2. Documentation includes data format requirements and examples
3. Validation script can optionally add column headers
4. System prepared for Engineering to populate data
</verification>

<success_criteria>
- Clear handoff documentation created for Engineering team
- Validation script enhanced with optional fix capability
- Path forward established for Uniones sheet completion
- Human coordination point established for external dependency
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-model-foundation/07-07-SUMMARY.md`
</output>