---
phase: 12-frontend-union-selection-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - zeues-frontend/components/Modal.tsx
  - zeues-frontend/components/UnionTable.tsx
  - zeues-frontend/lib/version.ts
autonomous: true

must_haves:
  truths:
    - "Modal component can render overlays using React portals"
    - "UnionTable component shell exists ready for selection logic"
    - "Version detection utility can determine v3.0 vs v4.0 spools"
  artifacts:
    - path: "zeues-frontend/components/Modal.tsx"
      provides: "Reusable modal with createPortal"
      exports: ["Modal"]
    - path: "zeues-frontend/components/UnionTable.tsx"
      provides: "Union table component shell"
      exports: ["UnionTable"]
    - path: "zeues-frontend/lib/version.ts"
      provides: "Version detection utilities"
      exports: ["detectSpoolVersion", "isV4Spool"]
  key_links:
    - from: "zeues-frontend/components/Modal.tsx"
      to: "react-dom"
      via: "createPortal import"
      pattern: "createPortal.*from.*react-dom"
---

<objective>
Create base UI components for union selection and version detection

Purpose: Build the foundational React components that will be used across the v4.0 UI - a reusable modal, union table shell, and version detection utility
Output: Modal.tsx with portal rendering, UnionTable.tsx component shell, and version.ts utilities
</objective>

<execution_context>
@/Users/sescanella/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sescanella/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-union-selection-ux/12-CONTEXT.md
@.planning/phases/12-frontend-union-selection-ux/12-RESEARCH.md

# Reference existing component patterns
@zeues-frontend/components/SpoolTable.tsx
@zeues-frontend/components/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable Modal component</name>
  <files>zeues-frontend/components/Modal.tsx</files>
  <action>
    Create a new Modal.tsx component using React's createPortal for overlay rendering:

    ```typescript
    'use client';

    import React, { useEffect } from 'react';
    import { createPortal } from 'react-dom';

    interface ModalProps {
      isOpen: boolean;
      onClose?: () => void;
      onBackdropClick?: (() => void) | null;
      children: React.ReactNode;
      className?: string;
    }

    export function Modal({ isOpen, onClose, onBackdropClick, children, className }: ModalProps) {
      // Component implementation
    }
    ```

    Key features:
    1. Use createPortal to render at document body level
    2. Backdrop with configurable click behavior (null disables backdrop dismiss)
    3. Fade-in/out animation using Tailwind transitions (200ms duration)
    4. Focus trap within modal when open
    5. ESC key closes modal (if onClose provided)
    6. Prevent body scroll when modal is open (add overflow-hidden to body)
    7. Z-index management (z-50 for backdrop, z-50 for modal content)

    Styling:
    - Backdrop: `fixed inset-0 bg-black/50 transition-opacity duration-200`
    - Modal container: `fixed inset-0 flex items-center justify-center p-4`
    - Content wrapper: `bg-white rounded-lg shadow-xl max-w-md w-full p-6`
    - Allow className override for custom styling

    CRITICAL: Handle SSR properly - only use createPortal after component mounts (useEffect)
  </action>
  <verify>cd zeues-frontend && npx tsc --noEmit</verify>
  <done>Modal component created with portal rendering and proper TypeScript types</done>
</task>

<task type="auto">
  <name>Task 2: Create UnionTable component shell</name>
  <files>zeues-frontend/components/UnionTable.tsx</files>
  <action>
    Create UnionTable.tsx component shell (without selection logic for now):

    ```typescript
    'use client';

    import React from 'react';

    interface Union {
      n_union: number;
      dn_union: number;
      tipo_union: string;
      is_completed?: boolean;
      arm_fecha_fin?: string;
      sol_fecha_fin?: string;
    }

    interface UnionTableProps {
      unions: Union[];
      operacion: 'ARM' | 'SOLD';
      selectedUnions?: number[];
      onSelectionChange?: (selected: number[]) => void;
      disabled?: boolean;
    }

    export function UnionTable({ unions, operacion, selectedUnions = [], onSelectionChange, disabled }: UnionTableProps) {
      // Component implementation
    }
    ```

    Structure:
    1. Table with 4 columns: Checkbox | N_UNION | DN_UNION | TIPO_UNION
    2. Sticky header using Tailwind `sticky top-0`
    3. Rows with 64px min-height for touch targets
    4. Completed unions show visual indicators:
       - Disabled row with `opacity-50`
       - Strikethrough text using `line-through`
       - Badge: "✓ Armada" or "✓ Soldada" based on operacion
    5. Sort unions by n_union ascending (use Array.sort)

    Table styling:
    - Container: `overflow-auto` for scrolling
    - Table: `w-full border-collapse`
    - Header: `bg-gray-50 border-b sticky top-0`
    - Rows: `border-b hover:bg-gray-50 transition-colors`
    - Checkbox cell: `w-16 text-center`
    - Badge: `inline-flex items-center px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded`

    NOTE: This is just the shell - selection logic will be added in Plan 04
  </action>
  <verify>cd zeues-frontend && npm run lint</verify>
  <done>UnionTable component shell created with proper structure and styling</done>
</task>

<task type="auto">
  <name>Task 3: Create version detection utility</name>
  <files>zeues-frontend/lib/version.ts</files>
  <action>
    Create version.ts utility for spool version detection:

    ```typescript
    // Version detection utilities for v3.0 vs v4.0 spools

    interface SpoolMetrics {
      total_uniones: number;
      [key: string]: unknown;
    }

    /**
     * Detects if a spool is v4.0 based on union count
     * v4.0 spools have total_uniones > 0
     * v3.0 spools have total_uniones = 0 or undefined
     */
    export function isV4Spool(metrics: SpoolMetrics | null | undefined): boolean {
      if (!metrics) return false;
      return metrics.total_uniones > 0;
    }

    /**
     * Returns version string for display
     */
    export function detectSpoolVersion(metrics: SpoolMetrics | null | undefined): 'v3.0' | 'v4.0' {
      return isV4Spool(metrics) ? 'v4.0' : 'v3.0';
    }

    /**
     * Cache key for session storage
     */
    export function getVersionCacheKey(tagSpool: string): string {
      return `spool_version_${tagSpool}`;
    }

    /**
     * Cache version in session storage
     */
    export function cacheSpoolVersion(tagSpool: string, version: 'v3.0' | 'v4.0'): void {
      if (typeof window !== 'undefined' && window.sessionStorage) {
        window.sessionStorage.setItem(getVersionCacheKey(tagSpool), version);
      }
    }

    /**
     * Get cached version from session storage
     */
    export function getCachedVersion(tagSpool: string): 'v3.0' | 'v4.0' | null {
      if (typeof window !== 'undefined' && window.sessionStorage) {
        const cached = window.sessionStorage.getItem(getVersionCacheKey(tagSpool));
        if (cached === 'v3.0' || cached === 'v4.0') {
          return cached;
        }
      }
      return null;
    }
    ```

    IMPORTANT:
    - Handle SSR properly with typeof window checks
    - Simple logic: total_uniones > 0 means v4.0
    - Session storage for caching to avoid redundant API calls
    - Type-safe version strings ('v3.0' | 'v4.0')
  </action>
  <verify>cd zeues-frontend && npm run build</verify>
  <done>Version detection utilities created with proper SSR handling and session storage caching</done>
</task>

</tasks>

<verification>
1. TypeScript check: `npx tsc --noEmit` - no errors
2. ESLint: `npm run lint` - no warnings
3. Build: `npm run build` - successful
4. Component exports verified
</verification>

<success_criteria>
- [ ] Modal component uses createPortal for overlay rendering
- [ ] Modal handles backdrop clicks and ESC key properly
- [ ] UnionTable shell has 4-column structure with sticky header
- [ ] UnionTable shows completion badges for finished unions
- [ ] Version detection based on total_uniones > 0
- [ ] Session storage caching implemented for version
- [ ] All components properly typed with TypeScript
- [ ] SSR-safe implementations (window checks)
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-union-selection-ux/12-02-SUMMARY.md`
</output>