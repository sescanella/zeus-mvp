---
phase: 12-frontend-union-selection-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - zeues-frontend/lib/types.ts
  - zeues-frontend/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript types exist for Union, DisponiblesResponse, MetricasResponse, IniciarRequest, FinalizarRequest"
    - "API client functions can call v4.0 endpoints with proper typing"
    - "No 'any' types introduced into the codebase"
  artifacts:
    - path: "zeues-frontend/lib/types.ts"
      provides: "Union interface and v4.0 response types"
      exports: ["Union", "DisponiblesResponse", "MetricasResponse", "IniciarRequest", "IniciarResponse", "FinalizarRequest", "FinalizarResponse"]
    - path: "zeues-frontend/lib/api.ts"
      provides: "v4.0 API client functions"
      exports: ["getUnionMetricas", "getDisponiblesUnions", "iniciarSpool", "finalizarSpool"]
  key_links:
    - from: "zeues-frontend/lib/api.ts"
      to: "zeues-frontend/lib/types.ts"
      via: "import statement"
      pattern: "import.*from.*types"
---

<objective>
Create TypeScript types and API client functions for v4.0 union-level workflows

Purpose: Establish the type-safe foundation for Phase 12 frontend work, ensuring all v4.0 data structures are properly typed and API interactions follow existing patterns
Output: Extended types.ts with Union interfaces and api.ts with 4 new v4.0 endpoint functions
</objective>

<execution_context>
@/Users/sescanella/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sescanella/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-frontend-union-selection-ux/12-CONTEXT.md
@.planning/phases/12-frontend-union-selection-ux/12-RESEARCH.md

# Reference existing frontend types and API patterns
@zeues-frontend/lib/types.ts
@zeues-frontend/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create v4.0 TypeScript types</name>
  <files>zeues-frontend/lib/types.ts</files>
  <action>
    Extend the existing types.ts file with v4.0 union-level types:

    1. Create Union interface:
    ```typescript
    export interface Union {
      n_union: number;
      dn_union: number;
      tipo_union: string;
      arm_fecha_inicio?: string;
      arm_fecha_fin?: string;
      arm_worker?: string;
      sol_fecha_inicio?: string;
      sol_fecha_fin?: string;
      sol_worker?: string;
      ndt_fecha?: string;
      ndt_status?: string;
      is_completed?: boolean; // Computed field for UI
    }
    ```

    2. Create v4.0 API response types:
    - DisponiblesResponse: { tag_spool: string; operacion: string; uniones: Union[]; total_uniones: number; disponibles_count: number }
    - MetricasResponse: { tag_spool: string; total_uniones: number; uniones_arm_completadas: number; uniones_sold_completadas: number; pulgadas_arm: number; pulgadas_sold: number }
    - IniciarRequest: { tag_spool: string; worker_id: number; worker_nombre: string; operacion: 'ARM' | 'SOLD' }
    - IniciarResponse: { success: boolean; message: string; tag_spool: string; ocupado_por: string }
    - FinalizarRequest: { tag_spool: string; worker_id: number; worker_nombre: string; operacion: 'ARM' | 'SOLD'; selected_unions: number[]; fecha_operacion: string }
    - FinalizarResponse: { success: boolean; message: string; action: 'PAUSAR' | 'COMPLETAR' | 'CANCELAR'; pulgadas_completadas: number; uniones_completadas: number }

    CRITICAL: Use proper TypeScript types, never use 'any'. All fields must have explicit types.
  </action>
  <verify>cd zeues-frontend && npx tsc --noEmit</verify>
  <done>TypeScript compilation passes with no errors, all v4.0 types properly exported</done>
</task>

<task type="auto">
  <name>Task 2: Add v4.0 API client functions</name>
  <files>zeues-frontend/lib/api.ts</files>
  <action>
    Add four new API client functions to api.ts following the existing pattern:

    1. getUnionMetricas(tag: string): Promise<MetricasResponse>
       - GET /api/v4/uniones/{tag}/metricas
       - Used for version detection on P3

    2. getDisponiblesUnions(tag: string, operacion: 'ARM' | 'SOLD'): Promise<DisponiblesResponse>
       - GET /api/v4/uniones/{tag}/disponibles?operacion={operacion}
       - Used to load available unions on P5

    3. iniciarSpool(payload: IniciarRequest): Promise<IniciarResponse>
       - POST /api/v4/occupation/iniciar
       - Used when INICIAR is clicked (occupies spool without union selection)

    4. finalizarSpool(payload: FinalizarRequest): Promise<FinalizarResponse>
       - POST /api/v4/occupation/finalizar
       - Used when completing union selection on P5

    IMPORTANT:
    - Use native fetch() API (NOT axios) to match existing pattern
    - Include proper error handling with try/catch
    - Return typed responses using the types from Task 1
    - Use NEXT_PUBLIC_API_URL environment variable for base URL
    - Add proper headers: 'Content-Type': 'application/json'
    - For GET requests with path params, use template literals
    - For POST requests, use JSON.stringify(payload) in body
  </action>
  <verify>cd zeues-frontend && npm run lint</verify>
  <done>ESLint passes with no errors, all 4 API functions exported and properly typed</done>
</task>

<task type="auto">
  <name>Task 3: Verify type integration and build</name>
  <files>zeues-frontend/lib/api.ts</files>
  <action>
    Run comprehensive type checking and build verification:

    1. Ensure api.ts properly imports all new types from types.ts
    2. Verify no 'any' types are used (ESLint will catch this)
    3. Run production build to ensure no runtime issues

    This is a verification task to ensure Tasks 1-2 integrate properly.
  </action>
  <verify>cd zeues-frontend && npm run build</verify>
  <done>Next.js production build completes successfully with no type errors or warnings</done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` - no errors
2. ESLint check: `npm run lint` - no warnings or errors
3. Build verification: `npm run build` - successful build
4. Exports verification: All types and functions properly exported
</verification>

<success_criteria>
- [ ] Union interface created with all fields from Uniones sheet
- [ ] 6 v4.0 response/request types created (DisponiblesResponse, MetricasResponse, IniciarRequest/Response, FinalizarRequest/Response)
- [ ] 4 API client functions added (getUnionMetricas, getDisponiblesUnions, iniciarSpool, finalizarSpool)
- [ ] No 'any' types in the codebase
- [ ] TypeScript compilation passes
- [ ] ESLint passes with no warnings
- [ ] Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/12-frontend-union-selection-ux/12-01-SUMMARY.md`
</output>